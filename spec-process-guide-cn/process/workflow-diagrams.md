# 工作流图表和视觉辅助

本文档提供了规范驱动开发流程的可视化表示，包括完整的工作流图、决策树和阶段转换流程。

## 完整流程图

下图显示了从初始构想到实施的完整规范驱动开发工作流：

```mermaid
stateDiagram-v2
    [*] --> 构想 : 功能请求
    
    构想 --> 需求 : 开始规范流程
    
    state 需求 {
        [*] --> 起草需求 : 创建初始需求
        起草需求 --> 审查需求 : 完成草稿
        审查需求 --> 修订需求 : 反馈/变更
        修订需求 --> 审查需求 : 更新草稿
        审查需求 --> [*] : 明确批准
    }
    
    需求 --> 设计 : 需求已批准
    
    state 设计 {
        [*] --> 研究 : 确定研究需求
        研究 --> 起草设计 : 创建设计文档
        起草设计 --> 审查设计 : 完成草稿
        审查设计 --> 修订设计 : 反馈/变更
        修订设计 --> 审查设计 : 更新草稿
        审查设计 --> [*] : 明确批准
    }
    
    设计 --> 任务 : 设计已批准
    
    state 任务 {
        [*] --> 起草任务 : 创建任务分解
        起草任务 --> 审查任务 : 完成草稿
        审查任务 --> 修订任务 : 反馈/变更
        修订任务 --> 审查任务 : 更新草稿
        审查任务 --> [*] : 明确批准
    }
    
    任务 --> 实施 : 任务已批准
    
    state 实施 {
        [*] --> 执行任务 : 选择下一个任务
        执行任务 --> 测试任务 : 完成任务
        测试任务 --> 更多任务 : 任务完成
        更多任务 --> 执行任务 : 是
        更多任务 --> [*] : 否
    }
    
    实施 --> [*] : 功能完成
    
    note right of 需求 : EARS 格式\n用户故事\n验收标准
    note right of 设计 : 架构\n组件\n数据模型
    note right of 任务 : 编码任务\n测试驱动\n增量
```

## 阶段转换决策树

此决策树有助于确定何时在阶段之间移动以及何时进行迭代：

```mermaid
flowchart TD
    A[阶段完成] --> B{用户审查}
    B -->|明确批准| C[进入下一阶段]
    B -->|反馈/变更| D[修订当前阶段]
    B -->|重大问题| E{变更范围}
    
    E -->|微小调整| D
    E -->|根本性变更| F{重新审视哪个阶段?}
    
    F -->|需求问题| G[返回需求阶段]
    F -->|设计问题| H[返回设计阶段]
    F -->|任务问题| I[修订任务]
    
    D --> J[更新文档]
    G --> K[更新需求]
    H --> L[更新设计]
    I --> M[更新任务]
    
    J --> A
    K --> A
    L --> A
    M --> A
    
    C --> N{最后阶段?}
    N -->|否| O[开始下一阶段]
    N -->|是| P[开始实施]
    
    O --> A
    P --> Q[执行任务]
```

## 需求阶段流程

需求收集阶段的详细工作流：

```mermaid
flowchart TD
    A[功能构想] --> B[分析初始请求]
    B --> C[创建初始需求草稿]
    C --> D[使用 EARS 语法格式化]
    D --> E[添加用户故事]
    E --> F[定义验收标准]
    F --> G[考虑边缘案例]
    G --> H[呈现给用户]
    
    H --> I{用户反馈}
    I -->|已批准| J[需求完成]
    I -->|需要变更| K[确定变更区域]
    I -->|需求不明确| L[提出澄清问题]
    
    K --> M[更新需求]
    L --> N[收集附加信息]
    
    M --> H
    N --> M
    
    J --> O[进入设计阶段]
    
    style A fill:#e1f5fe
    style J fill:#c8e6c9
    style O fill:#fff3e0
```

## 设计阶段流程

设计阶段的详细工作流：

```mermaid
flowchart TD
    A[需求已批准] --> B[确定研究需求]
    B --> C[进行研究]
    C --> D[分析发现]
    D --> E[创建架构概述]
    E --> F[定义组件]
    F --> G[设计数据模型]
    G --> H[规划错误处理]
    H --> I[定义测试策略]
    I --> J[向用户呈现设计]
    
    J --> K{用户反馈}
    K -->|已批准| L[设计完成]
    K -->|需要变更| M[更新设计]
    K -->|需求差距| N[返回需求阶段]
    
    M --> J
    N --> O[更新需求]
    O --> P[更新设计]
    P --> J
    
    L --> Q[进入任务阶段]
    
    style A fill:#fff3e0
    style L fill:#c8e6c9
    style Q fill:#f3e5f5
```

## 任务阶段流程

将设计分解为实施任务的详细工作流：

```mermaid
flowchart TD
    A[设计已批准] --> B[分析设计组件]
    B --> C[确定实施顺序]
    C --> D[创建任务层次结构]
    D --> E[定义任务依赖关系]
    E --> F[添加需求参考]
    F --> G[确保测试驱动方法]
    G --> H[验证任务完整性]
    H --> I[向用户呈现任务]
    
    I --> J{用户反馈}
    J -->|已批准| K[任务完成]
    J -->|需要变更| L[更新任务]
    J -->|设计问题| M[返回设计阶段]
    J -->|需求问题| N[返回需求阶段]
    
    L --> I
    M --> O[更新设计]
    N --> P[更新需求]
    
    O --> Q[更新任务]
    P --> R[更新设计和任务]
    
    Q --> I
    R --> I
    
    K --> S[开始实施]
    
    style A fill:#f3e5f5
    style K fill:#c8e6c9
    style S fill:#ffecb3
```

## 实施执行流程

从实施计划中执行单个任务的工作流：

```mermaid
flowchart TD
    A[任务已批准] --> B[选择下一个任务]
    B --> C{有子任务?}
    C -->|是| D[先执行子任务]
    C -->|否| E[阅读需求和设计]
    
    D --> F[完成所有子任务]
    F --> G[标记父任务完成]
    
    E --> H[实施任务]
    H --> I[编写测试]
    I --> J[对照需求验证]
    J --> K[标记任务完成]
    
    G --> L{更多任务?}
    K --> L
    
    L -->|是| B
    L -->|否| M[功能完成]
    
    style A fill:#ffecb3
    style M fill:#c8e6c9
```

## 反馈循环模式

处理反馈和迭代的常见模式：

```mermaid
flowchart LR
    subgraph "正反馈循环"
        A1[完成阶段] --> B1[用户审查]
        B1 --> C1[批准]
        C1 --> D1[下一阶段]
    end
    
    subgraph "修订循环"
        A2[完成阶段] --> B2[用户审查]
        B2 --> C2[反馈]
        C2 --> D2[修订]
        D2 --> A2
    end
    
    subgraph "回溯循环"
        A3[当前阶段] --> B3[重大问题]
        B3 --> C3[上一阶段]
        C3 --> D3[修复问题]
        D3 --> E3[更新当前]
        E3 --> A3
    end
    
    style C1 fill:#c8e6c9
    style C2 fill:#fff3e0
    style B3 fill:#ffcdd2
```

## 入口点和背景

用户可以进入规范工作流的不同方式：

```mermaid
flowchart TD
    A[用户意图] --> B{入口点}
    
    B -->|新功能| C[创建新规范]
    B -->|更新现有| D[修改规范]
    B -->|执行任务| E[实施模式]
    
    C --> F[需求阶段]
    D --> G{哪个阶段?}
    E --> H[任务执行]
    
    G -->|需求| I[更新需求]
    G -->|设计| J[更新设计]
    G -->|任务| K[更新任务]
    
    F --> L[完整工作流]
    I --> L
    J --> L
    K --> L
    H --> M[单一任务焦点]
    
    style C fill:#e1f5fe
    style D fill:#fff3e0
    style E fill:#ffecb3
```

## 质量门禁和验证点

整个过程中的关键验证检查点：

```mermaid
flowchart TD
    subgraph "需求质量门禁"
        A1[EARS 格式检查]
        A2[用户故事验证]
        A3[验收标准完整]
        A4[已考虑边缘案例]
    end
    
    subgraph "设计质量门禁"
        B1[架构清晰度]
        B2[组件定义]
        B3[数据模型完整性]
        B4[错误处理计划]
    end
    
    subgraph "任务质量门禁"
        C1[任务粒度]
        C2[依赖顺序]
        C3[需求可追溯性]
        C4[测试驱动结构]
    end
    
    subgraph "实施质量门禁"
        D1[代码质量]
        D2[测试覆盖率]
        D3[需求合规性]
        D4[集成成功]
    end
    
    A1 --> A2 --> A3 --> A4
    B1 --> B2 --> B3 --> B4
    C1 --> C2 --> C3 --> C4
    D1 --> D2 --> D3 --> D4
    
    A4 --> B1
    B4 --> C1
    C4 --> D1
```

## 常见工作流场景

### 场景1：平滑的线性进展
```mermaid
sequenceDiagram
    participant U as 用户
    participant A as AI 代理
    participant R as 需求
    participant D as 设计
    participant T as 任务
    
    U->>A: 功能请求
    A->>R: 创建需求
    A->>U: 审查需求
    U->>A: 批准
    A->>D: 创建设计
    A->>U: 审查设计
    U->>A: 批准
    A->>T: 创建任务
    A->>U: 审查任务
    U->>A: 批准
    Note over U,T: 准备实施
```

### 场景2：迭代求精
```mermaid
sequenceDiagram
    participant U as 用户
    participant A as AI 代理
    participant R as 需求
    participant D as 设计
    
    U->>A: 功能请求
    A->>R: 创建需求 v1
    A->>U: 审查需求
    U->>A: 需要变更
    A->>R: 更新需求 v2
    A->>U: 审查需求
    U->>A: 批准
    A->>D: 创建设计 v1
    A->>U: 审查设计
    U->>A: 发现需求差距
    A->>R: 更新需求 v3
    A->>D: 更新设计 v2
    A->>U: 审查设计
    U->>A: 批准
```

### 场景3：实施反馈
```mermaid
sequenceDiagram
    participant U as 用户
    participant A as AI 代理
    participant T as 任务
    participant I as 实施
    
    Note over U,I: 规范完成，开始实施
    U->>A: 执行任务 1
    A->>I: 实施任务 1
    A->>U: 任务 1 完成
    U->>A: 执行任务 2
    A->>I: 实施任务 2
    A->>U: 发现问题
    U->>A: 修复方法
    A->>T: 更新任务 2
    A->>I: 重新实施任务 2
    A->>U: 任务 2 完成
```

这些视觉辅助工具为理解和导航规范驱动开发流程提供了全面的指导，为学习该方法论的新手和寻求快速参考材料的经验丰富的从业者提供了支持。